<!DOCTYPE html>
<html>
<head>
    <title>Loading CS 1.6 Web</title>
    <style>
        canvas {
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
        }
        body { margin: 0; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/xash3d-fwgs@latest/dist/raw.js"></script>
</head>
<body>
<canvas id="canvas"></canvas>
<script type="module">
    async function main() {
        const files = {};

        // Fetch the full ZIP directly
        const res = await fetch('https://cdn.jsdelivr.net/gh/FAT32-fs/cs1.6@main/valve.zip', {
            mode: 'cors',
            cache: 'no-store'
        });
        if (!res.ok) throw new Error("Failed to fetch valve.zip");

        const buf = new Uint8Array(await res.arrayBuffer());
        console.log("ZIP loaded, size:", buf.byteLength);

        // Write ZIP as a single file in Xash3D FS
        files["/rodir/valve.zip"] = buf;

        Xash3D({
            arguments: ['-windowed', '-game', 'cstrike', '+_vgui_menus', '0'],
            canvas: document.getElementById('canvas'),
            ctx: document.getElementById('canvas').getContext('webgl2', {
                alpha: false,
                depth: true,
                stencil: true,
                antialias: true
            }),
            dynamicLibraries: [
                "filesystem_stdio.wasm",
                "libref_gles3compat.wasm",
                "cl_dlls/menu_emscripten_wasm32.wasm",
                "dlls/cs_emscripten_wasm32.so",
                "cl_dlls/client_emscripten_wasm32.wasm",
                "/rwdir/filesystem_stdio.so",
            ],
            onRuntimeInitialized: function () {
                // Mount files in FS
                for (const path in files) {
                    const dir = path.split('/').slice(0, -1).join('/');
                    this.FS.mkdirTree(dir);
                    this.FS.writeFile(path, files[path]);
                }
                this.FS.chdir('/rodir');
            },
            locateFile: (p) => {
                switch (p) {
                    case 'xash.wasm':
                        return 'https://cdn.jsdelivr.net/npm/xash3d-fwgs@latest/dist/xash.wasm';
                    case '/rwdir/filesystem_stdio.so':
                    case 'filesystem_stdio.wasm':
                        return 'https://cdn.jsdelivr.net/npm/xash3d-fwgs@latest/dist/filesystem_stdio.wasm';
                    case 'libref_gles3compat.wasm':
                        return 'https://cdn.jsdelivr.net/npm/xash3d-fwgs@latest/dist/libref_gles3compat.wasm';
                    case 'cl_dlls/menu_emscripten_wasm32.wasm':
                        return 'https://cdn.jsdelivr.net/npm/cs16-client@latest/dist/cl_dll/menu_emscripten_wasm32.wasm';
                    case 'dlls/cs_emscripten_wasm32.so':
                        return 'https://cdn.jsdelivr.net/npm/cs16-client@latest/dist/dlls/cs_emscripten_wasm32.so';
                    case 'cl_dlls/client_emscripten_wasm32.wasm':
                        return 'https://cdn.jsdelivr.net/npm/cs16-client@latest/dist/cl_dll/client_emscripten_wasm32.wasm';
                    default:
                        return p;
                }
            },
        });
    }

    main();
</script>
</body>
</html>
